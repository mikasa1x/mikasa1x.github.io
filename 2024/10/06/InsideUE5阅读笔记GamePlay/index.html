<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="InsideUE5阅读笔记GamePlay">
<meta property="og:url" content="http://example.com/2024/10/06/InsideUE5%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0GamePlay/index.html">
<meta property="og:site_name" content="Coding中。。。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic1.zhimg.com/v2-bca44e1f846c37b12f08bc0a6659b4ae_r.jpg">
<meta property="og:image" content="https://pica.zhimg.com/80/v2-3bd34e0947e07fe6b4e54b025977b3ac_720w.webp">
<meta property="og:image" content="https://s21.ax1x.com/2024/10/06/pA8qUSJ.webp">
<meta property="og:image" content="https://s21.ax1x.com/2024/10/06/pA8qtW4.webp">
<meta property="og:image" content="https://s21.ax1x.com/2024/10/06/pA8q6YD.jpg">
<meta property="article:published_time" content="2024-10-06T15:29:35.000Z">
<meta property="article:modified_time" content="2024-10-06T15:30:54.103Z">
<meta property="article:author" content="九日">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic1.zhimg.com/v2-bca44e1f846c37b12f08bc0a6659b4ae_r.jpg">

<link rel="canonical" href="http://example.com/2024/10/06/InsideUE5%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0GamePlay/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>InsideUE5阅读笔记GamePlay | Coding中。。。</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Coding中。。。</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>Links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/06/InsideUE5%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0GamePlay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/3333.jpg">
      <meta itemprop="name" content="九日">
      <meta itemprop="description" content="饥冻虽切，违己交病">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coding中。。。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          InsideUE5阅读笔记GamePlay
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-10-06 23:29:35 / 修改时间：23:30:54" itemprop="dateCreated datePublished" datetime="2024-10-06T23:29:35+08:00">2024-10-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E7%B3%BB%E5%88%97/" itemprop="url" rel="index"><span itemprop="name">虚幻引擎系列</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<span id="more"></span>
<title>InsideUE5阅读笔记GamePlay架构篇</title>
</head>
<body><h1 id='insideue5阅读笔记gameplay架构篇'>InsideUE5阅读笔记GamePlay架构篇</h1>
<p><a target="_blank" rel="noopener" href='https://zhuanlan.zhihu.com/p/22814098'>《InsideUE4》基础概念 - 知乎 (zhihu.com)</a></p>
<h2 id='ue5文件目录'>UE5文件目录</h2>
<ul>
<li><p>Binaries：存放编译生成的二进制文件（gitignore）</p>
</li>
<li><p>Config：配置文件</p>
</li>
<li><p>Content：蓝图、资源等</p>
</li>
<li><p>DervedDataCache（DDC）：引擎针对平台特化后的资源版本</p>
</li>
<li><p>Intermediate：各种中间文件</p>
<ul>
<li>Build中间文件</li>
<li>UHT预处理的.generated.h/.cpp文件</li>
<li>VS项目文件</li>
<li>AssetRegistryCache缓存文件，uasset资源注册表</li>

</ul>
</li>
<li><p>Saved：自动保存文件，日志，烘焙数据等</p>
</li>
<li><p>Source：代码文件</p>
</li>

</ul>
<p>&nbsp;</p>
<h2 id='命名约定'>命名约定</h2>
<ul>
<li>T：模板类TArray，TMap，TSet </li>
<li>U：UObject派生类</li>
<li>A：AActor派生类</li>
<li>S：SWidget派生类</li>
<li>I：抽象接口</li>
<li>E：枚举类</li>
<li>b：bool变量</li>
<li>F：其他类型——FString，FName</li>

</ul>
<p>&nbsp;</p>
<h2 id='uobject'>UObject</h2>
<p>UE游戏世界的所有类基类，提供元数据、反射生成、GC垃圾回收、序列化、编辑器可见，Class Default Object等。动态创建。</p>
<p><font color=red><strong>一句话介绍：</strong></font><em><strong>大多数与游戏逻辑、资源管理相关的类都继承自UObject，UObject为这些类提供了反射、序列化、GC等功能，AActor就是其中之一。Actor通过组装Component来实现一些具体的功能，同时也可以通过UChildActorComponent实现父子嵌套（SceneComponent有transform，所以理论上SC会被当成RootComponent，而且父子嵌套的实质也是SceneComponent之间的嵌套）。同样继承于UObject的ULevel中含有所有Actor的引用，Level也就是关卡，也可以理解为大地图上的一块区域，多个Level组成一个World。再往上走，World由WorldContext来进行切换，切换world的本质是切换PersisitentLevel。world之上就是GameInstance了。</strong></em></p>
<p>&nbsp;</p>
<p><strong>AActor</strong></p>
<p>继承自UObject，额外提供Replication（网络复制），Spawn（生命周期），Tick（更新）功能。此外，Actor提供TArray存储子Actor。</p>
<p>Actor不提供Transform，因为有许多不需要带有坐标的object也是Actor，比如世界设置对象，游戏模式对象等，UE不需要这些没有坐标的对象独立划出空间来存储“坐标”来浪费空间。</p>
<p>&nbsp;</p>
<p><strong>Component</strong></p>
<p>UActorComponent的简称，是所有Compnents的基类。</p>
<p>在AActor中，有一个<strong>TSet&lt;UActorComponent*&gt; OwnedComponents</strong>，保存着这个Actor所拥有的所有Component,一般其中会有一个<strong>SceneComponent</strong>作为RootComponent。</p>
<blockquote><p>Actor中支持包含多个SceneComponent，也就是一个Actor其实可以代表多个实体</p>
</blockquote>
<p><strong>TArray&lt;UActorComponent*&gt; InstanceComponents</strong>，存储被实例化的Components。</p>
<p>如果Actor要想被放进Level中，必须要有实例化USceneComponent（源码中声明为“RootComponent”），在这个Component中，包含<strong>Transform</strong>和<strong>SceneComponent</strong>相互嵌套功能。</p>
<p>虚幻引擎遵循<strong>组合优于继承</strong>的概念，所以只有带有Transform的SceneComponent拥有嵌套功能，其他组件不能相互继承嵌套。</p>
<p>Actor之间有父子关系的概念，但是Actor并不关心父子关系，Actor只负责对象的网络同步，创建销毁等功能，父子关系由SceneComponent负责，因为他又Transform，在3D坐标世界上就能理解了。所以Actor的类“AddChildren”的方法“<strong>Child：AttachToActor</strong>“是间接通过调度”Child:AttachToComponent“来创建父子关系的。</p>
<p>&nbsp;</p>
<p><strong>Level</strong></p>
<blockquote><p>由多个Level组成一个World，是Actor的容器，供玩家活动的场景，包含静态网格体（Static Mesh）、体积（Volume）、光源（Light）、蓝图（Blueprint）。</p>
<p>Level的释放和加载是动态的，类似于Unity引擎中的”场景“，Level可以视为闯关类游戏中的会切换场景的关卡，也可以视为吃鸡游戏中将大地图动态进行划分的区域（不可视区域没必要加载）。这样的粒度也方面团队协作。</p>
</blockquote>
<p><img src="https://pic1.zhimg.com/v2-bca44e1f846c37b12f08bc0a6659b4ae_r.jpg"></p>
<ul>
<li>ALevelScriptActor:顾名思义即Level自己的脚本，可以在这个脚本内获取关卡内所有的Actor，可以编写这个Level的相关游戏逻辑。</li>
<li>AWorldSettings：AInfo类的类都不直接放入world中，这个worldsetting只和本Level相关，内含各种Level相关的配置设置，例如GameMode等</li>

</ul>
<blockquote><p><a target="_blank" rel="noopener" href='https://www.52vr.com/extDoc/ue4/CHN/Engine/Levels/WorldSettings/index.html#:~:text=通过 World Settings 选项可执行一系列操作，从游玩关卡时启动正确的 游戏模式，到调整关卡的全局照明。 在关卡编辑器的 工具栏 上点击,World Settings 面板在编辑器 UI 中的默认位置在 Details 面板旁边。 可在此指定当前关卡的设置。'>世界场景设置（World Settings） | Unreal Engine (52vr.com)</a></p>
</blockquote>
<ul>
<li>AInfo：那些再world中没有物理展示的Actor基类，保存world中设置数据的管理类，也可以作为实现复制意图的Actor使用。</li>

</ul>
<blockquote><p>ALevelScriptActor意思是关卡的脚本Actor，用于执行Level中的逻辑操作，而WorldSetting继承于AInfo，用于操作游戏世界的设置。</p>
<p>在Level中，WorldSetting记录本Level中的所有规则属性，Level记录了Level内的所有Actor。而Actor内也存储WorldSettings和LevelScriptActor。</p>
</blockquote>
<hr />
<p><strong>ULevel内的Actor排序</strong></p>
<p>ULevel内有一个<code>TArray&lt;AActor*&gt; Actors</code>字段存储关卡内所有Actor，遍历Actors会很花时间，所有Level内有一个排序Actor的方法<code>ULevel::SortActorList()</code>，他会单独把网络对象和非网络对象分开，网络对象放在后面，并使用索引进行标记，可以加速网络复制的检测速度。（AWorldSettings是静态数据提供者，是放在最前列的）</p>
<p><strong>于Unity的异同</strong></p>
<p>Unity中和Level很像的场景概念叫Scene</p>
<ul>
<li>Scene之间独立，一个Scene包含它自己需要的对象、组件、光照等，切换场景时完全卸载；Level可以由多个Sublevel组成，多个Sublevel流式加载到同一个主关卡。虽然Unity也支持流式加载，但Unity的Scene加载需要在代码中手动管理控制，没有向UE那样直观。</li>

</ul>
<blockquote><p>UE5中被<strong>World Partition</strong>替换，自动将世界分块，根据玩家视角与距离动态加载卸载</p>
</blockquote>
<ul>
<li>Scene本身没有逻辑，要完成一些关卡相关的逻辑必须单独挂GameObject加脚本逻辑；Level有单独的关卡蓝图脚本系统，如ALevelScriptActor。</li>

</ul>
<hr />
<p>&nbsp;</p>
<p><strong>World</strong></p>
<p>在World中用SubLevel的方式将Level拼接起来。</p>
<p>PersisitentLevel：一开始就加载进来的Level</p>
<p>StreamingLevels：动态加载进来的Level</p>
<p>Levels：当前已经加载进来的Level</p>
<p>当然可以一口气把单独的Level放进PersisitentLevel里，也可以按照流式加载进行区分，如果是后者则World里有一个叫CurrentLevel的引用，在编辑器里指向其他Level，而运行时只指向PersistentLevel。</p>
<p>相关WorldSetting以PersistentLevel为主，也有单独为特定Level配置的设置。</p>
<p>Level之间不会共享Actor的引用，但是碰撞时全局的，也就是说所有的Actor物理实体是在World当中的。</p>
<p>&nbsp;</p>
<p><strong>WorldContext</strong></p>
<pre><code class='language-c++' lang='c++'>namespace EWorldType
&#123;
    enum Type
    &#123;
        None,		// An untyped world, in most cases this will be the vestigial worlds of streamed in sub-levels
        Game,		// The game world
        Editor,		// A world being edited in the editor
        PIE,		// A Play In Editor world
        Preview,	// A preview world for an editor tool
        Inactive	// An editor world that was loaded but not currently being edited in the level editor
    &#125;;
&#125;
</code></pre>
<blockquote><p>各种不同的World类型</p>
</blockquote>
<p>WorldContext就是管理这些不同World的工具，负责World之间切换的上下文，也负责Level之间切换的操作信息。</p>
<p>&nbsp;</p>
<p><strong>GameInstance</strong></p>
<p>继承于UObject。</p>
<p>保存WorldContext和其他的整个游戏的信息，贯穿游戏始终，在整个游戏内保持一致。</p>
<p>惯常的做法是继承GameInstance，并编写那些能作用于整个游戏范围的逻辑，比如玩家的单机分数之类，这些是不随关卡退出而刷新的，比如联网逻辑或者全局游戏设置等。以此来”扩展“GameInstance的功能，可以在UE中配置自定义的GameInstance。</p>
<p>&nbsp;</p>
<p><strong>Engine</strong></p>
<p>分化为两个子类：UGameEngine和UEditorEngine。</p>
<p>UGameEngine指<strong>游戏运行时</strong>逻辑的引擎类，当游戏打包启动的时候负责游戏的核心逻辑。</p>
<p>UEditorEngine指<strong>编辑器状态</strong>的逻辑引擎类，负责创建和编辑游戏内容。</p>
<blockquote><p>启动PIE状态由UEditorEngine负责，但是启动之后的PIE状态本身就是由UGameEngine负责。</p>
</blockquote>
<p>&nbsp;</p>
<p><strong>GamePlayStatics</strong></p>
<p>蓝图静态方法的暴露类，方便操作蓝图数据库。</p>
<p>&nbsp;</p>
<h2 id='pawn'>Pawn</h2>
<blockquote><p>Possess然后传递Input</p>
</blockquote>
<p>继承于AActor。即“可操控的棋子”。</p>
<p>pawn定义了三个模板方法接口：</p>
<ul>
<li>可被Controller控制</li>
<li>PhysicsCollision表示</li>
<li>MovementInput基本响应接口</li>

</ul>
<p>对于Input，Actor本身能接受input事件，如wasd事件，但是接受事件之后如何进行响应Actor就没有继续进行处理了。而Pawn额外包装了一层MovementInput，可以理解为默认地增加了“按下w之后会向前移动”的逻辑接口。</p>
<p><font color=red><strong>一句话介绍：</strong></font><em><strong>Pawn就是一个特殊的Actor，它具备“可被控制”、“物理Collision表示”、“移动响应MovementInput”接口三个基本功能，可以对这三个功能进行定制化，派生出“默认的DefaultPawn”、”观战SpectatorPawn“、”人型Character“。AController也是特殊的Actor，用于控制Pawn，可以派生出APlayerController和AAIController。APlayerState继承于AInfo，AInfo是没有物理表示的AActor，APlayerState于AController绑定在一群，充当网络复制的数据状态。</strong></em></p>
<p>&nbsp;</p>
<p><strong>DefaultPawn</strong></p>
<p>默认的Pawn，带有默认的DefaultPawnMovementComponent、spherical CollisionComponent和StaticMeshComponent。</p>
<p>&nbsp;</p>
<p><strong>SpectatorPawn</strong></p>
<p>继承于DefaultPawn，将Movement改为了“USpectatorPawnMovement（不带重力漫游）”，关闭了StaticMesh显示，定义了一个“观战摄像机”行为。</p>
<p>&nbsp;</p>
<p><strong>Character</strong></p>
<p>继承于Pawn，人型pawn。</p>
<p>相当于带人型骨架的Pawn，同样带有移动、碰撞体、mesh三部分，不过是人型的。</p>
<p>&nbsp;</p>
<p><strong>Controller</strong></p>
<p>继承于<strong>AActor</strong>。</p>
<p>Controller于Pawn是一一对应的，也就是说如果碰上需要一次性操控多个Pawn，或者多个Ctr控制单个Pawn的情况，需要进行特殊处理。有种鼓励人们去进行扩展的意思，毕竟一对一的模式更加方便引擎自身进行项目管理和错误筛查。</p>
<blockquote><p><strong>和Unity的不同</strong>：</p>
<p>Unity是GameObject+Component的模式，自由组合，对此并没有任何定义，也就是说控制器、角色本体、甚至MVC模式设计模式本身都需要从0开发。这给了设计者非常大的自由性。</p>
<p>UE规定好UObject、Actor、Component的各自职责，衍生出了Pawn+Controller的角色控制模式，更加强调类之间的层级关系。</p>
</blockquote>
<blockquote><p><strong>Controller与Pawn</strong>：</p>
<ul>
<li>Pawn与Controller都掌管Actor“运动“的概念，其中Pawn更强调”运动的能力“，例如碰撞检测、动画播放、位置更新等；而Controller更强调”运动的决策“，也就是运动自身的逻辑，什么时候该走，该往哪个方向走。</li>
<li>Pawn更强调能力，也就是说Pawn更适合编写特地的一些功能逻辑，例如战车与坦克，坦克能开炮，战车不能，所以坦克Pawn需要编写开跑功能；而他们两者都能驾驶，所以可以使用同一个Controller来控制他们两个。</li>
<li>Controller更面向玩家，Pawn因为某些情况”死掉了“，例如血条清空等，那么Pawn自身就析构了，而Controller还存在，毕竟实际上玩家还是有权利控制控制器的，只不过可能得不到反馈罢了。所以如果有持久性的例如玩家得分需要进行记录，那么可以放在Controller当中进行逻辑处理。</li>

</ul>
</blockquote>
<p>&nbsp;</p>
<p><strong>APlayerState</strong></p>
<p>继承于AInfo。AInfo应该不陌生，也就是”没有实体的Actor“。</p>
<p>Controller可以存取玩家状态，就是通过其内部引用的APlayState实现的。</p>
<p>APlayerState与Pawn、Controller是平级的关系，虽然和Controller绑定，但其实有多少实际的玩家才会生成多少APlayerState。</p>
<p>APlayerState独立成一个Actor还能保证网络同步时的数据稳定性，比如UE的网络架构中，如果断开连接，那么Controller就消失了，再次连接上时重新使用APlayerState的数据进行重连就好了。</p>
<blockquote><p>APlayerState在切换关卡的时候也会被释放掉，所以和GameInstance作区分，照开发实际需求来就好。</p>
</blockquote>
<p>&nbsp;</p>
<p><strong>APlayerController</strong></p>
<p>继承于AController</p>
<ul>
<li>Camera管理——可以知道Camera是挂在Controller上而不是Pawn了</li>
<li>Input系统</li>
<li>UPlayer关联（LocalPlayer或者UNetConnection）</li>
<li>HUD显示</li>
<li>Level切换（网络切换Level通过PCtr进行RPC调用后转发到自己的World）</li>
<li>Voice</li>

</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>AAIController</strong></p>
<p>继承于AController</p>
<ul>
<li>Navigation导航</li>
<li>AI行为树等其他AI组件</li>
<li>Task系统</li>

</ul>
<p><img src="https://pica.zhimg.com/80/v2-3bd34e0947e07fe6b4e54b025977b3ac_720w.webp"></p>
<p>&nbsp;</p>
<h2 id='gamemode'>GameMode</h2>
<p>由AInfo派生。管控Level相关逻辑。</p>
<ul>
<li>Class登记与实体Spawn：反射出的UClass类型信息就登记在此，用于方便Spawn出新对象。</li>
<li>游戏进度：重启游戏、暂停游戏的支持。SetPause、ResartPlayer函数进行逻辑控制。</li>

</ul>
<ul>
<li>Level切换：可以指定是否播放开场动画。</li>
<li>多人游戏状态：MatchState指定开始状态结束状态。</li>

</ul>
<blockquote><p>Level Blueprint与GameMode：</p>
<ul>
<li>前者注重关卡内特殊表现，后者注重游戏本体逻辑</li>
<li>简而言之就是通用玩法可以放GameMode里</li>
<li>GameMode只在Server中有</li>
<li>GameMode与PlayerController职责很像，都是负责游戏玩法，连着和不冲突</li>

</ul>
</blockquote>
<p>&nbsp;</p>
<p><font color=red><strong>一句话介绍：</strong></font><em><strong>除了PlayerState，同样也有其他派生自AInfo的类，对应Level的State叫做”AWorldSetting“，对应一局游戏的State叫做”GameState“。GameMode更侧重于管控Level的逻辑，比如游戏进度等。每个Level都可以独立设置GameMode，也可以直接配置全局的GameMode。GameState代表了一局游戏中的数据，例如玩家一局中的得分等，而GameInstance表示的是贯穿一整个游戏程序的数据。</strong></em></p>
<p>&nbsp;</p>
<p><strong>GameState</strong></p>
<p>由AInfo派生，和APlayerState对应，保存当前游戏的状态数据，比如任务数据等。</p>
<blockquote><p>与GameInstance做区分，GS是一局游戏的数据，而GI是整个游戏程序的数据</p>
</blockquote>
<p>&nbsp;</p>
<h2 id='uplayer'>UPlayer</h2>
<blockquote><p>看到这里的时候不由得感到震惊，感觉UE做的GamePlay框架真的很多</p>
</blockquote>
<p>继承于UObject。是Actor与Game层之间的中间层。</p>
<p>级别比World更高，因为哪怕World不断切换，玩家是一成不变的。UPlayer当中置有PlayerController的引用，所以可以理解为两者是相互关联的（即引擎会为Player做输入相应）。UPlayer不代表游戏中的存在，而是确确实实代表玩家本身在Gameplay中的类。</p>
<p><font color=red><strong>一句话介绍：</strong></font><em><strong>GameInstance不仅保存World，也存储Player。LocalPlayer代表本地玩家，NetConnection代表远端的连接，负责同步远端的PlayerState。LocalPlayer再GameInstance除四害的适合就默认创建出来，而远程的玩家通过远程同步数据，并不具备输出能力。</strong></em></p>
<p><strong>ULocalPlayer</strong></p>
<p>UPlayer的派生，即本地玩家。GameInstance具有ULocalPlayer的列表，支持遍历访问实现本地玩家相关操作。</p>
<p>为了顺从UE越来越多的网络联机需求，单独分出来Local的玩家类，比UPlayer多出来了Viewport的功能逻辑，在本地屏幕上给出操作反馈。</p>
<blockquote><p>LocalPlayer创建流程：</p>
<p>1.初始化GameInstance默认创建GameViewportClient（管理渲染窗口、处理用户输入，与游戏视图和渲染系统交互）。</p>
<p>2.内部转发到GI的CreateLocalPlayer创建LocalPlayer，再创建PlayerController。</p>
<p>3.调用Ctr内部的InitPlayerState，将PlayerState与LocalPlayer对应上来。</p>
<p>4.网络联机中远程同步过来的PlayerState通过Replicated过来。</p>
</blockquote>
<p>&nbsp;</p>
<p><strong>UNetConnection</strong></p>
<p>UPlayer的派生，代表远程同步过来的玩家对象。</p>
<p>相比于ULocalPlayer，少了输出相关的逻辑。</p>
<p><a target="_blank" rel="noopener" href='https://imgse.com/i/pA8qUSJ'><img src="https://s21.ax1x.com/2024/10/06/pA8qUSJ.webp" referrerpolicy="no-referrer" alt="pA8qUSJ.webp"></a></p>
<p>&nbsp;</p>
<h2 id='gameinstance'>GameInstance</h2>
<p>继承于UObject。在GameEngine里创建。</p>
<ul>
<li>引擎初始化，init、shutDown</li>
<li>Player的创建，CreateLocalPlayer，GetLocalPlayers</li>
<li>GameMode的重载</li>
<li>OnlineSession的管理</li>

</ul>
<p>GameInstance可以被上层的Engine实例出多个的。（理论上）</p>
<blockquote><ul>
<li><strong>PIE</strong>：指在编辑器中按下“Play”后在<strong>编辑器的上下文</strong>当中运行的游戏，可以实现<strong>动态更改场景蓝图变量</strong>等。（存有GI）</li>

</ul>
<ul>
<li><strong>独立启动游戏</strong>：指脱离编辑器运行的游戏，通过<strong>编译/打包</strong>后运行的可执行文件。（存有GI）</li>

</ul>
<ul>
<li><strong>编辑器模式</strong>：直接在编辑器中进行操作，可以做到对场景、关卡、甚至动画等的<strong>实时</strong>浏览功能，但是没有输入相应。（不存有GI）</li>

</ul>
</blockquote>
<p>GI一般能做的业务逻辑：</p>
<ul>
<li>切换Level相关</li>
<li>自定义生成Player</li>
<li>UI相关（一般开发都是由专门的Actor负责管理UMG，但是使用GameInstance管理也是一种思路）</li>
<li>全局配置（游戏设置）</li>
<li>从游戏启动到游戏结束中需要存储的全局变量</li>

</ul>
<p>&nbsp;</p>
<p><strong>SaveGame</strong></p>
<p>GameInstance适合存储关卡外存储的数据变量，如果由需要存进内存中的持久性数据，可以考虑继承USaveGame，通过UObject的序列化机制来实现属性字段的序列化保存。</p>
<p>相关接口：</p>
<ul>
<li>CreateSaveGameObject</li>
<li>LoadGameFromSlot</li>

</ul>
<p>&nbsp;</p>
<p><a target="_blank" rel="noopener" href='https://imgse.com/i/pA8qtW4'><img src="https://s21.ax1x.com/2024/10/06/pA8qtW4.webp" referrerpolicy="no-referrer" alt="pA8qtW4.webp"></a></p>
<p><a target="_blank" rel="noopener" href='https://imgse.com/i/pA8q6YD'><img src="https://s21.ax1x.com/2024/10/06/pA8q6YD.jpg" referrerpolicy="no-referrer" alt="pA8q6YD.jpg"></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</body>
</html>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/10/01/C-%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE/" rel="prev" title="C++使用建议">
      <i class="fa fa-chevron-left"></i> C++使用建议
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/11/15/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/" rel="next" title="虚幻引擎启动阶段做了什么">
      虚幻引擎启动阶段做了什么 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#insideue5%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0gameplay%E6%9E%B6%E6%9E%84%E7%AF%87"><span class="nav-number">1.</span> <span class="nav-text">InsideUE5阅读笔记GamePlay架构篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ue5%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95"><span class="nav-number">1.1.</span> <span class="nav-text">UE5文件目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A"><span class="nav-number">1.2.</span> <span class="nav-text">命名约定</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uobject"><span class="nav-number">1.3.</span> <span class="nav-text">UObject</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pawn"><span class="nav-number">1.4.</span> <span class="nav-text">Pawn</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gamemode"><span class="nav-number">1.5.</span> <span class="nav-text">GameMode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uplayer"><span class="nav-number">1.6.</span> <span class="nav-text">UPlayer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gameinstance"><span class="nav-number">1.7.</span> <span class="nav-text">GameInstance</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="九日"
      src="/images/3333.jpg">
  <p class="site-author-name" itemprop="name">九日</p>
  <div class="site-description" itemprop="description">饥冻虽切，违己交病</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/mikasa1x" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mikasa1x" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



  <div class="links-of-recent-posts motion-element">
    <div class="links-of-recent-posts-title">
      <i class="fa fa-history fa-fw"></i>
      最近文章
    </div>
    <ul class="links-of-recent-posts-list">
        <li class="links-of-recent-posts-item">
          <a href="/2024/11/15/UMG%E4%B8%8ESlate/" title="2024&#x2F;11&#x2F;15&#x2F;UMG与Slate&#x2F;">UMG与Slate</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/11/15/UE4%E7%BC%96%E8%BE%91%E5%99%A8%E6%89%A9%E5%B1%95%E4%B8%8Eslate%E5%9F%BA%E7%A1%80/" title="2024&#x2F;11&#x2F;15&#x2F;UE4编辑器扩展与slate基础&#x2F;">UE4编辑器扩展与slate基础</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/11/15/%E8%99%9A%E5%B9%BB%E8%93%9D%E5%9B%BE/" title="2024&#x2F;11&#x2F;15&#x2F;虚幻蓝图&#x2F;">虚幻蓝图</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/11/15/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/" title="2024&#x2F;11&#x2F;15&#x2F;虚幻引擎启动阶段做了什么&#x2F;">虚幻引擎启动阶段做了什么</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/10/06/InsideUE5%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0GamePlay/" title="2024&#x2F;10&#x2F;06&#x2F;InsideUE5阅读笔记GamePlay&#x2F;">InsideUE5阅读笔记GamePlay</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/10/01/C-%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE/" title="2024&#x2F;10&#x2F;01&#x2F;C-使用建议&#x2F;">C++使用建议</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/10/01/UnrealC/" title="2024&#x2F;10&#x2F;01&#x2F;UnrealC&#x2F;">UnrealC++</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/10/01/lua%E8%BF%9B%E9%98%B6/" title="2024&#x2F;10&#x2F;01&#x2F;lua进阶&#x2F;">lua进阶</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/10/01/C-%E6%96%B0%E7%89%B9%E6%80%A7/" title="2024&#x2F;10&#x2F;01&#x2F;C-新特性&#x2F;">C++新特性</a>
        </li>
        <li class="links-of-recent-posts-item">
          <a href="/2024/09/19/lua%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="2024&#x2F;09&#x2F;19&#x2F;lua面向对象&#x2F;">lua面向对象</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">九日</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '9c0b290d84f2366fb16f',
      clientSecret: '144de4df5142a698e6252476ca667f41c64af669',
      repo        : 'blog-comment',
      owner       : 'mikasa1x',
      admin       : ['mikasa1x'],
      id          : 'da7e6def127f5af38208709b54711e56',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
